{% extends 'shop/basic.html'%}
{%block title%}My Awesome Cart Tracker{%endblock%}
{%block body%}
<div class="container">
    <div class="col my-2">
        <h2>Enter your Order ID and Email address to track your order</h2>
        <br>
        <form method="post" action="#" id="trackerform">{%csrf_token%}
        <div class="row">
            <div class="form-group col-md-6">
                <label for="name">Order ID :</label>
                <input type="text" name="orderid" class="form-control" id="orderid" placeholder="Order ID">
            </div>
            <div class="form-group col-md-6">
                <label for="email">Email :</label>
                <input type="email" name="email" class="form-control" id="email" placeholder="Email">
            </div>
        </div>
    </div>
    <center><button type="submit" class="btn btn-primary">Track Order</button>
    </form></center>

	<div class="col my-2">
	    
	    <h2>Order Status</h2>
	    <br>
	    <div id="item_div " class="my-2">
	        <ul class="list-group" id="items">
	        	Enter Your Order-ID and Email and click on Track Order to find details about your Order! 
	        </ul>
	    </div>
	    <h2>Order Details</h2>
	    <br>
	    <div id="item_div " class="my-2">
	        <ul class="list-group" id="items_detail">
	        </ul>
	    </div>
	</div>
</div>
</div>
{% endblock%}
{%block js%}
<script>
$('#trackerform').submit(function(event) {

    $('#items').empty();
    var formData = {
        'orderid': $('input[name=orderid]').val(),
        'email': $('input[name=email]').val(),
        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
    };
    $.ajax({
            type: 'POST',
            url: '/shop/tracker/',
            data: formData,
            encode: true
        })
        .done(function(data) {
        	data = JSON.parse(data);

            updates = data[0];
            if (updates.length > 0 & updates != {}) {

                for (i = 0; i < updates.length; i++) {
                    let text = updates[i]['text'];
                    let time = new Date(updates[i]['time']).toString().slice(0,25);
                    mystr = `<li class="list-group-item d-flex justify-content-between align-items-center">
		                    ${text}
		                    <span class="badge badge-primary badge-pill">${time}</span>
		                </li>`;
                    $('#items').append(mystr);
                }
            } else {
            	mystr = `<li class="list-group-item d-flex justify-content-between align-items-center">
		                    Sorry, We are not able to fetch this order id and email. Make sure to type correct order id and email.
		                </li>`;
            	$('#items').append(mystr);
            }

            //fill in thr order detail
            cart = JSON.parse(data[1]);
            for (item in cart) {
        let name = cart[item][1];
        let qty = cart[item][0];
        mystr = `<li class="list-group-item d-flex justify-content-between align-items-center">
	                    ${name}
	                    <span class="badge badge-primary badge-pill">${qty}</span>
	                </li>`;
        
        $('#items_detail').append(mystr);
    }


        });
    event.preventDefault();
});
</script>
{%endblock%}